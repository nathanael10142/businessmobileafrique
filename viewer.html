<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Lecteur de Document</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512'%3e%3cpath fill='%23C5A059' d='M320 0H128C101.5 0 80 21.49 80 48v416C80 490.5 101.5 512 128 512h192c26.51 0 48-21.49 48-48V48C368 21.49 346.5 0 320 0zM224 480c-17.69 0-32-14.32-32-32s14.31-32 32-32s32 14.32 32 32S241.7 480 224 480zM320 400H128V48h192V400z'/%3e%3c/svg%3e">
    
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: #525659;
        }
        .pdf-viewer-overlay {
            position: static;
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

    <div id="pdfModal" class="pdf-viewer-overlay">
        <div id="pdf-viewer-toolbar">
            <div class="toolbar-section">
                <button onclick="window.close()" class="toolbar-button" title="Fermer"><i class="fa-solid fa-times"></i></button>
                <h3 id="pdfModalTitle" class="pdf-viewer-title">Chargement...</h3>
            </div>
            <div class="toolbar-section">
                <span id="pdf-page-indicator">Page 1 / 1</span>
            </div>
            <div class="toolbar-section">
                <button id="pdf-download-btn" class="toolbar-button" title="Télécharger"><i class="fa-solid fa-download"></i></button>
                <button id="zoom-out-btn" class="toolbar-button" title="Zoom arrière"><i class="fa-solid fa-search-minus"></i></button>
                <button id="zoom-in-btn" class="toolbar-button" title="Zoom avant"><i class="fa-solid fa-search-plus"></i></button>
            </div>
        </div>
        <div id="pdf-viewer-content">
            <div id="pdf-render-area">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <!-- ✅ AJOUT : MODALE DE MISE À JOUR DISPONIBLE -->
    <div id="updateAvailableModal" class="modal-overlay" style="display: none;">
        <div class="modal-content text-center">
            <div class="modal-header" style="justify-content: center;">
                <h3 class="modal-title"><i class="fa-solid fa-rocket"></i> Mise à jour disponible !</h3>
            </div>
            <div class="modal-body">
                <p>Une nouvelle version de l'application est prête. Mettez à jour maintenant pour profiter des dernières fonctionnalités et corrections.</p>
                <button id="updateNowBtn" class="btn btn-primary" style="width: 100%;"><i class="fa-solid fa-sync-alt"></i> Mettre à jour maintenant</button>
                <button id="updateLaterBtn" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">Plus tard</button>
            </div>
        </div>
    </div>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

    <!-- Le script du lecteur PDF sera injecté ici -->
    <script>
        // On récupère les paramètres de l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const fileUrl = urlParams.get('file');
        const title = urlParams.get('title');

        // On met à jour le titre de la page et de la barre d'outils
        document.title = title || 'Lecteur de Document';
        document.getElementById('pdfModalTitle').textContent = title || 'Lecteur de Document';

        // On configure et on lance le lecteur PDF
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
        
        // On injecte le script du tableau de bord qui contient les fonctions du lecteur
        const script = document.createElement('script');
        script.src = 'js/user-dashboard.js';
        script.onload = function() {
            renderPdf(fileUrl);
            document.getElementById('pdf-download-btn').onclick = () => downloadPdf(fileUrl, title);
        };
        document.body.appendChild(script);
    </script>

</body>
</html>